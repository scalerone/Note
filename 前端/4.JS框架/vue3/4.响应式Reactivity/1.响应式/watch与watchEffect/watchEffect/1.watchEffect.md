# watchEffect

## 概述

+ `watchEffect` 是 Vue3 的新函数，你可以认为它是 watch 的升级版或加强版，它功能和 `watch` 相似，但却更加强大

+ 功能：它接收一个函数作为参数，并会立即执行传入的函数，同时响应式追踪其依赖，并在其依赖变更时重新运行该函数

+ `watchEffect` 会被立即执行(可以认为 `immediate: true`)，并且不管是修改 name 还是 age 都会触发 `watchEffect` 执行

+ 可以认为 `watchEffect` 内部使用到什么响应数据，就监听了什么响应数据，只要这些响应数据发生变化，就会触发 `watchEffect`

## 语法

+ 第一个参数就是要运行的副作用函数。这个副作用函数的参数也是一个函数，用来注册清理回调。清理回调会在该副作用下一次执行前被调用，可以用来清理无效的副作用，例如等待中的异步请求

+ 第二个参数是一个可选的选项，可以用来调整副作用的刷新时机或调试副作用的依赖

+ 返回值是一个用来停止该副作用的函数

  ```js
  const count = ref(0)

  watchEffect(() => console.log(count.value))
  // -> 输出 0

  count.value++
  // -> 输出 1
  ```

## 副作用清除

+ 副作用清除

  ```js
  watchEffect(async (onCleanup) => {
    const { response, cancel } = doAsyncWork(id.value)
    // `cancel` 会在 `id` 更改时调用
    // 以便取消之前
    // 未完成的请求
    onCleanup(cancel)
    data.value = await response
  })
  ```
