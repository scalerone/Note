# 基础

## 概述

+ 设置这个API的目的是为了让各种网页动画效果（DOM动画、Canvas动画、SVG动画、WebGL动画）能够有一个统一的刷新机制，从而节省系统资源，提高系统性能，改善视觉效果

+ 代码中使用这个API，就是告诉浏览器希望执行一个动画，让浏览器在下一个动画帧安排一次网页重绘

## 特点

+ 按帧对网页进行重绘。该方法告诉浏览器希望执行动画并请求浏览器在下一次重绘之前调用回调函数来更新动画

+ 由系统来决定回调函数的执行时机机，在运行时浏览器会自动优化方法的调用显示器有固定的刷新频率（60Hz 或 75Hz），也就是说，每秒最多只能重绘60 次或 75 次，requestAnimationFrame 的基本思想让页面重绘的频率与这个刷新频率保持同步

  - 比如显示器屏幕刷新率为 60Hz，使用 `requestAnimationFrame` API，那么回调函数就每 1000ms/ 60 ≈ 16.7ms 执行一次；如果显示器屏幕的刷新率为 75Hz，那么回调函数就每 1000ms / 75 ≈ 13.3ms 执行一次

+ `通过 requestAnimationFrame` 调用回调函数引起的页面重绘或回流的时间间隔和显示器的刷新时间间隔相同。所以 `requestAnimationFrame` 不需要像 `setTimeout` 那样传时间间隔，而是浏览器通过系统获取并使用显示器刷新频率

## 优势

+ 从实现的功能和使用方法上，`requestAnimationFrame` 与定时器 `setTimeout` 都相似，所以说其优势是同 `setTimeout` 实现的动画相比

1. 提升性能，防止掉帧

      - 浏览器 UI 线程：浏览器让执行 JavaScript 和更新用户界面（包括重绘和回流）共用同一个单线程，称为“浏览器 UI 线程”

      - 浏览器 UI 线程的工作基于一个简单的队列系统，任务会被保存到队列中直到进程空闲。一旦空闲，队列中的下一个任务就被重新提取出来并运行。这些任务要么是运行 JavaScript 代码，要么执行 UI 更新

2. 节约资源，节省电源

      - 使用 `setTimeout` 实现的动画，当页面被隐藏或最小化时，定时器 `setTimeout` 仍在后台执行动画任务，此时刷新动画是完全没有意义的（实际上 FireFox/Chrome浏览器对定时器做了优化：页面闲置时，如果时间间隔小于 1000ms，则停止定时器，与 `requestAnimationFrame` 行为类似。如果时间间隔>=1000ms，定时器依然在后台执行）

      - 使用 `requestAnimationFrame`，当页面处于未激活的状态下，该页面的屏幕刷新任务会被系统暂停，由于 `requestAnimationFrame` 保持和屏幕刷新同步执行，所以也会被暂停。当页面被激活时，动画从上次停留的地方继续执行，节约 CPU 开销

## 注意

+ `requestAnimationFrame` 是在主线程上完成

+ 这意味着，如果主线程非常繁忙，`requestAnimationFrame` 的动画效果会大打折扣

+ `requestAnimationFrame` 使用一个回调函数作为参数

+ 这个回调函数会在浏览器重绘之前调用

    ```js
    requestID = window.requestAnimationFrame(callback);
    ```
